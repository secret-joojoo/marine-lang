<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>악! 기합 해병이 되고 싶어! - 웹 컴파일러</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #8B0000; }
        
        /* 좌우 분할을 위한 Flexbox 레이아웃 설정 */
        .layout-container { display: flex; gap: 20px; align-items: stretch; }
        .left-panel, .right-panel { flex: 1; display: flex; flex-direction: column; }
        
        textarea { width: 100%; font-family: monospace; font-size: 14px; padding: 10px; box-sizing: border-box; resize: vertical; }
        #code { flex-grow: 1; min-height: 300px; }
        #input_data { height: 60px; }
        #output { background-color: #f4f4f4; border: 1px solid #ccc; padding: 10px; flex-grow: 1; min-height: 350px; white-space: pre-wrap; font-family: monospace; overflow-y: auto; }
        
        button { background-color: #8B0000; color: white; padding: 10px 20px; border: none; cursor: pointer; font-size: 16px; margin: 10px 0; align-self: flex-start; }
        button:hover { background-color: #a50000; }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>

    <h1>악! 기합 해병이 되고 싶어!</h1>
    <p>웹 브라우저에서 직접 코드를 실행해 보세요.</p>

    <div class="layout-container">
        <div class="left-panel">
            <h3>소스 코드 (.ak)</h3>
            <textarea id="code">
신병 받아라 악!!!!!!!악!!
신병 받아라 악!악악!
신병 받아라 악!악악!!!!!!!!
신병 받아라 악!악!악!
신병 받아라 악!!!!악!!!!
신병 받아라 악!!!악!!
신병 받아라 악!악!악!!!!!!!!!
신병 받아라 악!악!악!!!!
신병 받아라 악!악악
신병 받아라 악!!!악!!!
신병 받아라 악!!!악!!!
아쎄이 아쎄이! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!! 돌격
라이라이 차차차
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격
아쎄이 아쎄이!!!!!!!!!! 돌격
라이라이 차차차
아쎄이 아쎄이 역돌격</textarea>

            <h3>헤이빠빠리빠</h3>
            <textarea id="input_data" placeholder="입력값이 필요할 경우 미리 작성하세요."></textarea>

            <button id="runBtn" disabled>인터프리터 로딩 중...</button>
        </div>

        <div class="right-panel">
            <h3>실행 결과</h3>
            <div id="output"></div>
        </div>
    </div>

    <script>
        let pyodide;
        let interpreterCode = "";

        async function main() {
            pyodide = await loadPyodide();
            
            try {
                const response = await fetch('./interpreter.py');
                if (!response.ok) throw new Error("인터프리터 파일을 찾을 수 없다!");
                
                let rawCode = await response.text();
                
                // [기합찬 팁] 웹 환경에서는 CLI 실행 블록이 돌면 프로그램이 뻗어버리니까, 
                // if __name__ == "__main__": 부분을 if False: 로 치환해서 강제로 비활성화한다!
                interpreterCode = rawCode.replace('if __name__ == "__main__":', 'if False:');
                
                document.getElementById("runBtn").disabled = false;
                document.getElementById("runBtn").innerText = "실행한다!";
            } catch (e) {
                document.getElementById("runBtn").innerText = "로딩 실패! 기열!";
                console.error("인터프리터 로드 에러:", e);
                document.getElementById("output").innerText = "인터프리터를 불러오지 못했다! 기열!";
            }
        }
        main();

        const webWrapperCode = `
import sys
import io

def run_in_browser(code_str, input_str):
    old_stdout = sys.stdout
    old_stdin = sys.stdin
    sys.stdout = io.StringIO()
    sys.stdin = io.StringIO(input_str)
    
    try:
        interpreter = MarineLangInterpreter(code_str)
        interpreter.run()
        result = sys.stdout.getvalue()
    except Exception as e:
        result = str(e)
    finally:
        sys.stdout = old_stdout
        sys.stdin = old_stdin
        
    return result
`;

        document.getElementById("runBtn").addEventListener("click", async () => {
            const codeStr = document.getElementById("code").value;
            const inputStr = document.getElementById("input_data").value;
            const outputDiv = document.getElementById("output");
            
            outputDiv.innerHTML = "<span class='loading'>실행 중...</span>";

            try {
                await pyodide.runPythonAsync(interpreterCode + "\n\n" + webWrapperCode);
                
                const runFunc = pyodide.globals.get('run_in_browser');
                const result = runFunc(codeStr, inputStr);
                
                outputDiv.innerText = result;
                
                runFunc.destroy();
            } catch (err) {
                outputDiv.innerText = "시스템 오류:\n" + err;
            }
        });
    </script>
</body>
</html>